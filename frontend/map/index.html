<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8">
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="../node_modules/cesium/Build/Cesium/Cesium.js"></script>
    <script src="../node_modules/axios/dist/axios.min.js"></script>
    <style>
        @import url(../node_modules/cesium/Build/Cesium/Widgets/widgets.css);

        html, body, #cesiumContainer {
            width: 95%;
            height: 95%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #container {
            position: absolute;
            top: 5%;
            left: 30%;
            margin-top: -50px;
            margin-left: -50px;
            width: 50%;
            height: 105%;
        }

        #container:hover {
            background: blue; /* make this whatever you want */
        }

        #logo-img {
            width: 275px;
            height: 50px;
            margin-left: 20px;
        }

        .base-container {
            float: left;
            width: 110%;
            border-radius: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);
        }

        .draggable {
            background-color: white;
            z-index: 1000;
        }
    </style>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 tab-color">
            <div class="page-header" id="watchdog-logo-container">
                <img id="logo-img" src="../img/logo.png" alt="Nasa Watchdog">
            </div>
            <div class="base-container draggable" style="cursor: move;">
                <div style="margin: 10px;">
                    <div align="center">
                        <h2>Location</h2>
                    </div>
                    <div class="form-group">
                        <label for="latitudeInput">Latitude</label>
                        <input type="text" class="form-control" id="latitudeInput" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="longitudeInput">Longitude</label>
                        <input type="text" class="form-control" id="longitudeInput" placeholder="">
                    </div>
                    <button id="show-location" class="btn btn-default">Show on map</button>
                </div>
            </div>

            <div class="base-container draggable" style="margin-top: 25px; height: 450px; cursor: move">
                <div align="center">
                    <h2>Feed</h2>
                </div>
                <div id="tickerContainer tab-color" style="width: 95%; height: 300%; margin-left: 2.5%;">
                    <dl id="ticker" style="width: 100%; height: 25%;">
                        <dt class="heading">
                            <img src="data/first_image.jpg" style="width: 100%; height: 200px">
                        </dt>
                        <dd class="text">
                            <div class="item active" style="width: 80%; margin-left:10px;">
                                <div>Report from #Fez in #Morocco (famous for leather) looks like the edge of a huge CB
                                    #cloud that triggered the alerts on map 33/30 #eustorm
                                </div>
                            </div>
                        </dd>

                        <dt class="heading">
                            <img src="data/second_image.jpg" style="width: 100%; height: 200px"></dt>
                        <dd class="text">
                            <div class="item" style="width: 80%; margin-left:10px;">
                                <div style="color:red">111.6mm of #rain so far in #Huelva #Spain this morning #flooding
                                    underway in many areas! We thank @MPEGrupo & @weatherpablo for the reports.
                                </div>
                            </div>
                        </dd>

                        <dt class="heading">
                            <img src="data/third_image.jpg" style="width: 100%; height: 200px">
                        </dt>
                        <dd class="text">
                            <div class="item" style="width: 80%; margin-left:10px;">
                                <div>Giant Earth crack opens up in Northern Cape, South Africa <a
                                        href="http://buff.ly/2lm8qCj">http://buff.ly/2lm8qCj</a></div>
                            </div>
                        </dd>

                        <dt class="heading">
                            <img src="data/fourth_image.jpg" style="width: 100%; height: 200px">
                        </dt>
                        <dd class="text">
                            <div class="item" style="width: 80%; margin-left:10px;">
                                <div style="color:orange">Gigantic earth #crack opens up in #Pakistan sparking fears
                                    among locals <a
                                            href="http://strangesounds.org/2017/02/gigantic-earth-crack-pakistan-video-sparking-fears-among-locals.html">http://strangesounds.org/2017/02/gigantic-earth-crack-pakistan-video-sparking-fears-among-locals.html</a>
                                    â€¦ via @Strange_Sounds
                                </div>
                            </div>
                        </dd>
                    </dl>
                </div>
            </div>

        </div>
        <div id="container" class="col-sm-6 tab-color">
            <div id="cesiumContainer" class="col-md-4" style="margin-left: 2.25%;"></div>
        </div>
        <div class="col-sm-3 tab-color"></div>
    </div>
</div>
<script>

    $(function () {

        /**
         * @type {Cesium.Viewer}
         * initiazlie map
         */
        var viewer = new Cesium.Viewer('cesiumContainer');

        getLocation();

        var ticker = $("#ticker");
        ticker.children().filter("dt").each(function () {
            var dt = $(this),
                container = $("<div>");
            dt.next().appendTo(container);
            dt.prependTo(container);
            container.appendTo(ticker);
        });
        ticker.css("overflow", "hidden");
        function animator(currentItem) {
            var distance = currentItem.height();
            duration = (distance + parseInt(currentItem.css("marginTop"))) / 0.025;
            currentItem.animate({marginTop: -distance}, duration, "linear", function () {
                currentItem.appendTo(currentItem.parent()).css("marginTop", 0);
                animator(currentItem.parent().children(":first"));
            });
        }

        animator(ticker.children(":first"));
        ticker.mouseenter(function () {
            ticker.children().stop();
        });
        ticker.mouseleave(function () {
            animator(ticker.children(":first"));
        });

        //draggable widgets
        $(".draggable").draggable({revert: true});

        $('#show-location').on('click', function (e) {
            let latitude = $('#latitudeInput').val();
            let longitude = $('#longitudeInput').val();
            let pinBuilder = new Cesium.PinBuilder();
            viewer.entities.removeAll();
            viewer.entities.add({
                position: Cesium.Cartesian3.fromDegrees(longitude, latitude, 0.0),
                label: {
                    verticalOrigin: Cesium.VerticalOrigin.TOP
                },
                billboard: {
                    image: pinBuilder.fromColor(Cesium.Color.SALMON, 48),
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                }
            });

            axios.post('http://www.watchdog.app:7777/app_dev.php/detect/disasters', {
                coordinates: {
                    latitude: 50.43510019,
                    longitude: 30.44928813
                }
            })
                .then(function (response) {
                    let data = response.data;
                    data.forEach(function(item, i ,array) {
                        console.log(item);
                        let coords = Cesium.Cartesian3.fromDegrees(item.longitude, item.latitude, 0.0);
                        viewer.entities.add({
                            position: coords,
                            ellipse: {
                                semiMinorAxis: item.safeZone * 10,
                                semiMajorAxis: item.safeZone * 10,
                                height: 0,
                                material: Cesium.Color.GREEN.withAlpha(0.5),
                            }
                        });
                        viewer.entities.add({
                            position: coords,
                            ellipse: {
                                semiMinorAxis: item.warningZone * 10,
                                semiMajorAxis: item.warningZone * 10,
                                height: 0,
                                material: Cesium.Color.YELLOW.withAlpha(0.5),
                            }
                        });
                        viewer.entities.add({
                            position: coords,
                            ellipse: {
                                semiMinorAxis: item.dangerZone * 10,
                                semiMajorAxis: item.dangerZone * 10,
                                height: 0,
                                material: Cesium.Color.RED.withAlpha(0.5),
                            }
                        });
                    });
                    viewer.zoomTo(viewer.entities);
                })
                .catch(function (error) {
                    console.log(error);
                });
        });

    });

    function getLocation() {
        navigator.geolocation.getCurrentPosition(fillInputs);
    }

    /**
     * @param position
     */
    function fillInputs(position) {
        $('#latitudeInput').val(position.coords.latitude);
        $('#longitudeInput').val(position.coords.longitude);
    }
</script>
</body>
</html>
